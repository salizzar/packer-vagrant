# -*- mode: ruby -*-
# vi: set ft=ruby :

# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!
VAGRANTFILE_API_VERSION = "2"

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  # base vagrant box name for application
  config.vm.box     = "{{ user `box_name` }}-{{ user `box_type` }}"
  config.vm.box_url = "http://vagrant.devintegration.locaweb.com.br/boxes/#{config.vm.box}.box"

  # network forwarding to access webserver on host (in the VM will be 3000)
  config.vm.network :forwarded_port, guest: 3000, host: 5000

  # virtual machine optimisation setting the RAM and number of processors
  config.vm.provider :virtualbox do |vb|
    vb.customize [ :modifyvm, :id, '--memory', '{{ user `box_memory` }}' ]
    vb.customize [ :modifyvm, :id, '--cpus',   '{{ user `box_cpus`   }}' ]
  end

  # main cookbook scripts
  config.vm.provision :shell, path: 'cookbooks/default'
  config.vm.provision :shell, path: 'cookbooks/fix_shared_folders'
  config.vm.provision :shell, path: 'cookbooks/bundler'

  # export SSH keys from host to guest
  config.ssh.forward_agent = true
end

